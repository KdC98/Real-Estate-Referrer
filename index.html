<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Karyne de Clercq - Programme Apporteurs Dubai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.6/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@2.4.2/i18nextHttpBackend.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.0/i18nextBrowserLanguageDetector.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-white">
    <div id="app"></div>
    <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    
    (async () => {
        // ✅ AJOUT : Déclaration manquante
        let isPasswordRecoveryMode = false;
        
        await i18next
            .use(i18nextHttpBackend)
            .use(i18nextBrowserLanguageDetector)
            .init({
                fallbackLng: 'fr',
                debug: true,
                load: 'languageOnly',
                ns: ['translation', 'auth', 'dashboard', 'common'],
                defaultNS: 'translation',
                backend: {
                    loadPath: '/locales/{{lng}}/{{ns}}.json'
                },
                detection: {
                    order: ['localStorage', 'navigator'],
                    caches: ['localStorage']
                }
            });
        
        console.log('🌐 Loading translations...');
        await i18next.loadNamespaces(['translation', 'auth', 'dashboard', 'common']);
        console.log('✅ All translations loaded!');
        
        const t = (key) => i18next.t(key);
        async function changeLanguage(langCode) {
            try {
                await i18next.changeLanguage(langCode);
                localStorage.setItem('i18nextLng', langCode);
                window.location.reload();
            } catch (error) {
                console.error('Erreur changement de langue:', error);
            }
        }
        window.changeLanguage = changeLanguage;
        
        const SUPABASE_URL = 'https://cgizcgwhwxswvoodqver.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnaXpjZ3dod3hzd3Zvb2RxdmVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0MzY1NDYsImV4cCI6MjA3NjAxMjU0Nn0.d5PWoeuz6Z322dnvLLKg4LBb6jUhWo4MyxlIGdxA3oc';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        window.supabase = supabase;
        
        let currentUser = null;
        let userProfile = null;
        let currentPage = 'landing';
        
        window.currentUser = null;
        window.userProfile = null;
        window.currentPage = 'landing';
        
        // [Vos fonctions renderLandingPage, renderAuthPage, renderDashboard restent identiques]
        // ... (le code reste le même jusqu'à la fonction checkFormValidity)
        
        function checkFormValidity() {
            const submitButton = document.getElementById('submitButton');
            if (!submitButton) return;
            
            const nameInput = document.getElementById('name');
            const phoneInput = document.getElementById('phone');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password') || document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword') || document.getElementById('confirmNewPassword');
            
            const nameValid = !nameInput || nameInput.value.trim().length >= 2;
            const emailValid = !emailInput || /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value.trim());
            
            let phoneValid = !phoneInput; // Si pas de champ phone, considéré valide
            
            if (phoneInput) {
                let phone = phoneInput.value.trim();
                phone = phone.replace(/^\+971\s*/, '');
                phone = phone.replace(/[\s\-\(\)]/g, '');
                phoneValid = /^[0-9]{9}$/.test(phone) && 
                           (['50','52','54','55','56','58','59'].includes(phone.substring(0,2)) || 
                            ['2','3','4','6','7','9'].includes(phone.charAt(0)));
            }
            
            let passwordValid = false;
            if (passwordInput) {
                const pwd = passwordInput.value;
                passwordValid = pwd.length >= 8 && /[a-zA-Z]/.test(pwd) && /[0-9]/.test(pwd);
            }
            
            const confirmPasswordValid = !confirmPasswordInput || 
                                        (confirmPasswordInput.value.length > 0 && 
                                         confirmPasswordInput.value === passwordInput?.value);
            
            const allValid = nameValid && phoneValid && emailValid && passwordValid && confirmPasswordValid;
            
            if (allValid) {
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                submitButton.disabled = true;
                submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // [Le reste de votre code reste identique]
        
    })();
    </script>
</body>
</html>

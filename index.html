<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Karyne de Clercq - Programme Apporteurs Dubai</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.6/i18next.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@2.4.2/i18nextHttpBackend.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.0/i18nextBrowserLanguageDetector.min.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
      min-height: 100vh;
    }
  </style>
</head>

<body class="text-white">
  <div id="app"></div>

  <script type="module">
  (async () => {

    // initialisation i18next
    await i18next
      .use(i18nextHttpBackend)
      .use(i18nextBrowserLanguageDetector)
      .init({
        fallbackLng: 'fr',
        debug: false,
        load: 'languageOnly',
        ns: ['translation', 'auth', 'dashboard'],
        defaultNS: 'translation',
        backend: { loadPath: '/locales/{{lng}}/{{ns}}.json' },
        detection: { order: ['localStorage', 'navigator'], caches: ['localStorage'] }
      });

    const t = (key) => i18next.t(key);

    async function changeLanguage(langCode) {
      try {
        await i18next.changeLanguage(langCode);
        localStorage.setItem('i18nextLng', langCode);
        window.location.reload();
      } catch (error) {
        console.error('Erreur changement de langue:', error);
      }
    }
    window.changeLanguage = changeLanguage;

    // import supabase sans importmap (compatible Safari)
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL = 'https://cgizcgwhwxswvoodqver.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnaXpjZ3dod3hzd3Zvb2RxdmVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0MzY1NDYsImV4cCI6MjA3NjAxMjU0Nn0.d5PWoeuz6Z322dnvLLKg4LBb6jUhWo4MyxlIGdxA3oc';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.supabase = supabase;

    // Ã©tats globaux
    let currentUser = null;
    let userProfile = null;
    let currentPage = 'landing';

    // affichage simplifiÃ© dâ€™une page de test (tu gardes le reste de ton code complet ici)
    function renderLandingPage() {
      return `
        <div class="min-h-screen flex flex-col items-center justify-center text-center">
          <h1 class="text-5xl font-bold text-yellow-400 mb-6">${t('nav.brand') || 'Programme Apporteurs Dubai'}</h1>
          <p class="text-xl text-gray-300 mb-8">${t('hero.subtitle') || 'Rejoignez le programme des apporteurs Ã  Dubai.'}</p>
          <div class="flex gap-4">
            <button onclick="changeLanguage('fr')" class="text-2xl">ðŸ‡«ðŸ‡·</button>
            <button onclick="changeLanguage('en')" class="text-2xl">ðŸ‡¬ðŸ‡§</button>
            <button onclick="changeLanguage('ar')" class="text-2xl">ðŸ‡¦ðŸ‡ª</button>
          </div>
        </div>
      `;
    }

    async function render() {
      document.getElementById('app').innerHTML = renderLandingPage();
    }

    // Ã©coute lâ€™Ã©tat de connexion
    supabase.auth.onAuthStateChange(async (event, session) => {
      currentUser = session?.user || null;
      render();
    });

    supabase.auth.getSession().then(({ data: { session } }) => {
      currentUser = session?.user || null;
      render();
    });

  })();
  </script>
</body>
</html>

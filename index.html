<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Referrer - Dubai</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18/client';
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
        import { Home, Users, DollarSign, TrendingUp, LogOut, Plus, CheckCircle, Menu, X } from 'https://esm.sh/lucide-react@0.263.1';

        const SUPABASE_URL = 'https://cgizcgwhwxswvoodqver.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnaXpjZ3dod3hzd3Zvb2RxdmVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0MzY1NDYsImV4cCI6MjA3NjAxMjU0Nn0.d5PWoeuz6Z322dnvLLKg4LBb6jUhWo4MyxlIGdxA3oc';

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const RealEstateReferralApp = () => {
            // Tous les states déclarés au début (obligatoire pour React hooks)
            const [currentPage, setCurrentPage] = useState('landing');
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [leads, setLeads] = useState([]);
            const [showAddLead, setShowAddLead] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            
            // Form states
            const [loginForm, setLoginForm] = useState({ email: '', password: '' });
            const [signupForm, setSignupForm] = useState({ name: '', email: '', password: '', phone: '' });
            const [leadForm, setLeadForm] = useState({
                clientName: '',
                clientEmail: '',
                clientPhone: '',
                propertyType: 'Appartement',
                budget: ''
            });

            // Charger les données au démarrage
            useEffect(() => {
                if (currentUser) {
                    loadData();
                }
            }, [currentUser]);

            const loadData = async () => {
                try {
                    // Charger tous les utilisateurs
                    const { data: usersData, error: usersError } = await supabase
                        .from('users')
                        .select('*')
                        .order('joined_at', { ascending: false });
                    
                    if (usersError) throw usersError;
                    setUsers(usersData || []);

                    // Charger les leads
                    if (currentUser.role === 'admin') {
                        const { data: leadsData, error: leadsError } = await supabase
                            .from('leads')
                            .select('*')
                            .order('created_at', { ascending: false });
                        
                        if (leadsError) throw leadsError;
                        setLeads(leadsData || []);
                    } else {
                        const { data: leadsData, error: leadsError } = await supabase
                            .from('leads')
                            .select('*')
                            .eq('referrer_id', currentUser.id)
                            .order('created_at', { ascending: false });
                        
                        if (leadsError) throw leadsError;
                        setLeads(leadsData || []);
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement des données:', error);
                    alert('Erreur lors du chargement des données: ' + error.message);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('email', loginForm.email)
                        .eq('password', loginForm.password)
                        .single();

                    if (error) throw error;
                    
                    if (data) {
                        setCurrentUser(data);
                        setCurrentPage(data.role === 'admin' ? 'admin-dashboard' : 'referrer-dashboard');
                        setLoginForm({ email: '', password: '' });
                    } else {
                        alert('Email ou mot de passe incorrect');
                    }
                } catch (error) {
                    console.error('Erreur de connexion:', error);
                    alert('Erreur de connexion: ' + error.message);
                }
            };

            const handleSignup = async (e) => {
                e.preventDefault();
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .insert([{
                            name: signupForm.name,
                            email: signupForm.email,
                            password: signupForm.password,
                            phone: signupForm.phone,
                            role: 'referrer'
                        }])
                        .select()
                        .single();

                    if (error) throw error;

                    alert('Compte créé avec succès ! Vous pouvez maintenant vous connecter.');
                    setCurrentPage('login');
                    setSignupForm({ name: '', email: '', password: '', phone: '' });
                } catch (error) {
                    console.error('Erreur lors de l\'inscription:', error);
                    alert('Erreur lors de l\'inscription: ' + error.message);
                }
            };

            const handleAddLead = async (e) => {
                e.preventDefault();
                try {
                    const { data, error } = await supabase
                        .from('leads')
                        .insert([{
                            referrer_id: currentUser.id,
                            client_name: leadForm.clientName,
                            client_email: leadForm.clientEmail,
                            client_phone: leadForm.clientPhone,
                            property_type: leadForm.propertyType,
                            budget: parseFloat(leadForm.budget),
                            status: 'nouveau'
                        }])
                        .select()
                        .single();

                    if (error) throw error;

                    alert('Lead ajouté avec succès !');
                    setShowAddLead(false);
                    setLeadForm({
                        clientName: '',
                        clientEmail: '',
                        clientPhone: '',
                        propertyType: 'Appartement',
                        budget: ''
                    });
                    loadData();
                } catch (error) {
                    console.error('Erreur lors de l\'ajout du lead:', error);
                    alert('Erreur lors de l\'ajout du lead: ' + error.message);
                }
            };

            const handleUpdateLeadStatus = async (leadId, newStatus, salePrice = null) => {
                try {
                    const updateData = { status: newStatus };
                    
                    if (newStatus === 'vendu' && salePrice) {
                        const price = parseFloat(salePrice);
                        const totalCommission = price * 0.02; // 2% du prix de vente
                        const agentCommission = totalCommission * 0.5; // 50% pour l'agent (1% du prix)
                        const referrerCommission = agentCommission * 0.2; // 20% de la part agent
                        
                        updateData.sale_price = price;
                        updateData.agent_commission = agentCommission;
                        updateData.referrer_commission = referrerCommission;
                        updateData.closed_at = new Date().toISOString();
                    }

                    const { error } = await supabase
                        .from('leads')
                        .update(updateData)
                        .eq('id', leadId);

                    if (error) throw error;

                    alert('Statut mis à jour avec succès !');
                    loadData();
                } catch (error) {
                    console.error('Erreur lors de la mise à jour:', error);
                    alert('Erreur lors de la mise à jour: ' + error.message);
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setCurrentPage('landing');
                setLeads([]);
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'AED',
                    minimumFractionDigits: 0
                }).format(amount || 0).replace('AED', 'AED');
            };

            const getStatusColor = (status) => {
                const colors = {
                    'nouveau': 'bg-blue-100 text-blue-800',
                    'visite': 'bg-yellow-100 text-yellow-800',
                    'offre': 'bg-orange-100 text-orange-800',
                    'vendu': 'bg-green-100 text-green-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            };

            // Calculs des statistiques
            const calculateStats = () => {
                const userLeads = currentUser?.role === 'admin' 
                    ? leads 
                    : leads.filter(l => l.referrer_id === currentUser?.id);
                
                const totalEarnings = userLeads
                    .filter(l => l.status === 'vendu')
                    .reduce((sum, l) => sum + (l.referrer_commission || 0), 0);
                
                const activeLeads = userLeads.filter(l => l.status !== 'vendu').length;
                const closedSales = userLeads.filter(l => l.status === 'vendu').length;
                
                return { totalEarnings, activeLeads, closedSales };
            };

            // LANDING PAGE
            if (currentPage === 'landing') {
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900' },
                    React.createElement('nav', { className: 'bg-slate-900/50 backdrop-blur-sm border-b border-gold-500/20' },
                        React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement(Home, { className: 'text-yellow-500', size: 28 }),
                                React.createElement('span', { className: 'text-2xl font-bold text-white' }, 'Real Estate Referrer')
                            ),
                            React.createElement('div', { className: 'flex gap-4' },
                                React.createElement('button', {
                                    onClick: () => setCurrentPage('login'),
                                    className: 'px-6 py-2 text-white hover:text-yellow-500 transition'
                                }, 'Connexion'),
                                React.createElement('button', {
                                    onClick: () => setCurrentPage('signup'),
                                    className: 'px-6 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-semibold hover:from-yellow-400 hover:to-yellow-500 transition'
                                }, 'Devenir Apporteur')
                            )
                        )
                    ),
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20' },
                        React.createElement('div', { className: 'text-center mb-16' },
                            React.createElement('h1', { className: 'text-5xl md:text-6xl font-bold text-white mb-6' },
                                'Gagnez jusqu\'à ',
                                React.createElement('span', { className: 'text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-600' }, '20,000 AED'),
                                ' par vente'
                            ),
                            React.createElement('p', { className: 'text-xl text-gray-300 mb-8' },
                                'Apportez des clients immobiliers et touchez 20% de la commission agent'
                            ),
                            React.createElement('button', {
                                onClick: () => setCurrentPage('signup'),
                                className: 'px-8 py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-bold text-lg hover:from-yellow-400 hover:to-yellow-500 transition transform hover:scale-105'
                            }, 'Nous Rejoindre')
                        ),
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-8 mb-16' },
                            [
                                { price: '3M AED', commission: '6,000 AED' },
                                { price: '5M AED', commission: '10,000 AED' },
                                { price: '10M AED', commission: '20,000 AED' }
                            ].map((example, idx) =>
                                React.createElement('div', { 
                                    key: idx,
                                    className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6 text-center hover:border-yellow-500/40 transition'
                                },
                                    React.createElement('div', { className: 'text-gray-400 mb-2' }, 'Vente à'),
                                    React.createElement('div', { className: 'text-2xl font-bold text-white mb-4' }, example.price),
                                    React.createElement('div', { className: 'text-yellow-500 text-xl font-bold' }, 
                                        '→ ', example.commission
                                    ),
                                    React.createElement('div', { className: 'text-sm text-gray-400 mt-2' }, 'de commission')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-8' },
                            React.createElement('h2', { className: 'text-3xl font-bold text-white mb-6 text-center' }, 'Comment ça marche ?'),
                            React.createElement('div', { className: 'grid md:grid-cols-3 gap-6' },
                                [
                                    { step: '1', title: 'Inscrivez-vous', desc: 'Créez votre compte gratuitement' },
                                    { step: '2', title: 'Apportez des clients', desc: 'Recommandez vos contacts intéressés' },
                                    { step: '3', title: 'Touchez votre commission', desc: '20% de la commission agent à la vente' }
                                ].map((step, idx) =>
                                    React.createElement('div', { key: idx, className: 'text-center' },
                                        React.createElement('div', { className: 'w-16 h-16 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-full flex items-center justify-center text-2xl font-bold text-slate-900 mx-auto mb-4' }, 
                                            step.step
                                        ),
                                        React.createElement('h3', { className: 'text-xl font-bold text-white mb-2' }, step.title),
                                        React.createElement('p', { className: 'text-gray-400' }, step.desc)
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // LOGIN PAGE
            if (currentPage === 'login') {
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center px-4' },
                    React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-8 w-full max-w-md' },
                        React.createElement('div', { className: 'text-center mb-8' },
                            React.createElement('h2', { className: 'text-3xl font-bold text-white' }, 'Connexion')
                        ),
                        React.createElement('form', { onSubmit: handleLogin },
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Email'),
                                React.createElement('input', {
                                    type: 'email',
                                    value: loginForm.email,
                                    onChange: (e) => setLoginForm({...loginForm, email: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    required: true
                                })
                            ),
                            React.createElement('div', { className: 'mb-6' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Mot de passe'),
                                React.createElement('input', {
                                    type: 'password',
                                    value: loginForm.password,
                                    onChange: (e) => setLoginForm({...loginForm, password: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    required: true
                                })
                            ),
                            React.createElement('button', {
                                type: 'submit',
                                className: 'w-full py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-bold hover:from-yellow-400 hover:to-yellow-500 transition'
                            }, 'Se connecter'),
                            React.createElement('div', { className: 'mt-4 text-center' },
                                React.createElement('button', {
                                    type: 'button',
                                    onClick: () => setCurrentPage('landing'),
                                    className: 'text-gray-400 hover:text-yellow-500 transition'
                                }, 'Retour à l\'accueil')
                            )
                        )
                    )
                );
            }

            // SIGNUP PAGE
            if (currentPage === 'signup') {
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center px-4' },
                    React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-8 w-full max-w-md' },
                        React.createElement('div', { className: 'text-center mb-8' },
                            React.createElement('h2', { className: 'text-3xl font-bold text-white' }, 'Devenir Apporteur')
                        ),
                        React.createElement('form', { onSubmit: handleSignup },
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Nom complet'),
                                React.createElement('input', {
                                    type: 'text',
                                    value: signupForm.name,
                                    onChange: (e) => setSignupForm({...signupForm, name: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    required: true
                                })
                            ),
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Email'),
                                React.createElement('input', {
                                    type: 'email',
                                    value: signupForm.email,
                                    onChange: (e) => setSignupForm({...signupForm, email: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    required: true
                                })
                            ),
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Téléphone'),
                                React.createElement('input', {
                                    type: 'tel',
                                    value: signupForm.phone,
                                    onChange: (e) => setSignupForm({...signupForm, phone: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    placeholder: '+971 ...',
                                    required: true
                                })
                            ),
                            React.createElement('div', { className: 'mb-6' },
                                React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Mot de passe'),
                                React.createElement('input', {
                                    type: 'password',
                                    value: signupForm.password,
                                    onChange: (e) => setSignupForm({...signupForm, password: e.target.value}),
                                    className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                    required: true,
                                    minLength: 6
                                })
                            ),
                            React.createElement('button', {
                                type: 'submit',
                                className: 'w-full py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-bold hover:from-yellow-400 hover:to-yellow-500 transition'
                            }, 'Créer mon compte'),
                            React.createElement('div', { className: 'mt-4 text-center' },
                                React.createElement('button', {
                                    type: 'button',
                                    onClick: () => setCurrentPage('landing'),
                                    className: 'text-gray-400 hover:text-yellow-500 transition'
                                }, 'Retour à l\'accueil')
                            )
                        )
                    )
                );
            }

            // REFERRER DASHBOARD
            if (currentPage === 'referrer-dashboard') {
                const stats = calculateStats();
                
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900' },
                    React.createElement('nav', { className: 'bg-slate-900/50 backdrop-blur-sm border-b border-yellow-500/20' },
                        React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement(Home, { className: 'text-yellow-500', size: 28 }),
                                React.createElement('span', { className: 'text-xl font-bold text-white' }, 'Mon Espace Apporteur')
                            ),
                            React.createElement('div', { className: 'flex items-center gap-4' },
                                React.createElement('span', { className: 'text-gray-300' }, currentUser.name),
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: 'flex items-center gap-2 px-4 py-2 text-white hover:text-yellow-500 transition'
                                },
                                    React.createElement(LogOut, { size: 20 }),
                                    'Déconnexion'
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-6 mb-8' },
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(DollarSign, { className: 'text-yellow-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Gains totaux'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, formatCurrency(stats.totalEarnings))
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(TrendingUp, { className: 'text-blue-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Leads en cours'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, stats.activeLeads)
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(CheckCircle, { className: 'text-green-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Ventes conclues'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, stats.closedSales)
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: 'mb-6 flex justify-between items-center' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-white' }, 'Mes Leads'),
                            React.createElement('button', {
                                onClick: () => setShowAddLead(!showAddLead),
                                className: 'flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-bold hover:from-yellow-400 hover:to-yellow-500 transition'
                            },
                                React.createElement(Plus, { size: 20 }),
                                'Ajouter un lead'
                            )
                        ),
                        showAddLead && React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6 mb-6' },
                            React.createElement('h3', { className: 'text-xl font-bold text-white mb-4' }, 'Nouveau Lead'),
                            React.createElement('form', { onSubmit: handleAddLead, className: 'grid md:grid-cols-2 gap-4' },
                                React.createElement('div', null,
                                    React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Nom du client'),
                                    React.createElement('input', {
                                        type: 'text',
                                        value: leadForm.clientName,
                                        onChange: (e) => setLeadForm({...leadForm, clientName: e.target.value}),
                                        className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                        required: true
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Email'),
                                    React.createElement('input', {
                                        type: 'email',
                                        value: leadForm.clientEmail,
                                        onChange: (e) => setLeadForm({...leadForm, clientEmail: e.target.value}),
                                        className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                        required: true
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Téléphone'),
                                    React.createElement('input', {
                                        type: 'tel',
                                        value: leadForm.clientPhone,
                                        onChange: (e) => setLeadForm({...leadForm, clientPhone: e.target.value}),
                                        className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                        required: true
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Type de bien'),
                                    React.createElement('select', {
                                        value: leadForm.propertyType,
                                        onChange: (e) => setLeadForm({...leadForm, propertyType: e.target.value}),
                                        className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500'
                                    },
                                        React.createElement('option', { value: 'Appartement' }, 'Appartement'),
                                        React.createElement('option', { value: 'Villa' }, 'Villa'),
                                        React.createElement('option', { value: 'Penthouse' }, 'Penthouse'),
                                        React.createElement('option', { value: 'Bureau' }, 'Bureau'),
                                        React.createElement('option', { value: 'Commerce' }, 'Commerce')
                                    )
                                ),
                                React.createElement('div', { className: 'md:col-span-2' },
                                    React.createElement('label', { className: 'block text-gray-300 mb-2' }, 'Budget (AED)'),
                                    React.createElement('input', {
                                        type: 'number',
                                        value: leadForm.budget,
                                        onChange: (e) => setLeadForm({...leadForm, budget: e.target.value}),
                                        className: 'w-full px-4 py-3 bg-slate-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500',
                                        required: true,
                                        min: '0'
                                    })
                                ),
                                React.createElement('div', { className: 'md:col-span-2 flex gap-4' },
                                    React.createElement('button', {
                                        type: 'submit',
                                        className: 'flex-1 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-slate-900 rounded-lg font-bold hover:from-yellow-400 hover:to-yellow-500 transition'
                                    }, 'Ajouter le lead'),
                                    React.createElement('button', {
                                        type: 'button',
                                        onClick: () => setShowAddLead(false),
                                        className: 'px-6 py-3 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition'
                                    }, 'Annuler')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl overflow-hidden' },
                            React.createElement('div', { className: 'overflow-x-auto' },
                                React.createElement('table', { className: 'w-full' },
                                    React.createElement('thead', { className: 'bg-slate-900/50' },
                                        React.createElement('tr', null,
                                            ['Client', 'Contact', 'Type', 'Budget', 'Statut', 'Commission'].map(header =>
                                                React.createElement('th', { 
                                                    key: header,
                                                    className: 'px-6 py-4 text-left text-sm font-semibold text-gray-300'
                                                }, header)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', { className: 'divide-y divide-slate-700' },
                                        leads.length === 0 
                                            ? React.createElement('tr', null,
                                                React.createElement('td', { colSpan: 6, className: 'px-6 py-8 text-center text-gray-400' },
                                                    'Aucun lead pour le moment. Ajoutez votre premier client !'
                                                )
                                            )
                                            : leads.map(lead =>
                                                React.createElement('tr', { key: lead.id, className: 'hover:bg-slate-700/30 transition' },
                                                    React.createElement('td', { className: 'px-6 py-4' },
                                                        React.createElement('div', { className: 'font-semibold text-white' }, lead.client_name),
                                                        React.createElement('div', { className: 'text-sm text-gray-400' }, lead.client_email)
                                                    ),
                                                    React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, lead.client_phone),
                                                    React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, lead.property_type),
                                                    React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, formatCurrency(lead.budget)),
                                                    React.createElement('td', { className: 'px-6 py-4' },
                                                        React.createElement('span', { className: `px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(lead.status)}` },
                                                            lead.status
                                                        )
                                                    ),
                                                    React.createElement('td', { className: 'px-6 py-4 font-bold text-yellow-500' },
                                                        lead.status === 'vendu' 
                                                            ? formatCurrency(lead.referrer_commission)
                                                            : '-'
                                                    )
                                                )
                                            )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // ADMIN DASHBOARD
            if (currentPage === 'admin-dashboard') {
                const stats = calculateStats();
                const allReferrers = users.filter(u => u.role === 'referrer');
                
                return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900' },
                    React.createElement('nav', { className: 'bg-slate-900/50 backdrop-blur-sm border-b border-yellow-500/20' },
                        React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement(Home, { className: 'text-yellow-500', size: 28 }),
                                React.createElement('span', { className: 'text-xl font-bold text-white' }, 'Admin Dashboard')
                            ),
                            React.createElement('div', { className: 'flex items-center gap-4' },
                                React.createElement('span', { className: 'text-gray-300' }, currentUser.name),
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: 'flex items-center gap-2 px-4 py-2 text-white hover:text-yellow-500 transition'
                                },
                                    React.createElement(LogOut, { size: 20 }),
                                    'Déconnexion'
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
                        React.createElement('div', { className: 'grid md:grid-cols-4 gap-6 mb-8' },
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(Users, { className: 'text-purple-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Apporteurs'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, allReferrers.length)
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(TrendingUp, { className: 'text-blue-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Leads actifs'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, stats.activeLeads)
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(CheckCircle, { className: 'text-green-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Ventes'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, stats.closedSales)
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl p-6' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-2' },
                                    React.createElement(DollarSign, { className: 'text-yellow-500', size: 32 }),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'text-gray-400 text-sm' }, 'Commissions versées'),
                                        React.createElement('div', { className: 'text-2xl font-bold text-white' }, formatCurrency(stats.totalEarnings))
                                    )
                                )
                            )
                        ),
                        React.createElement('h2', { className: 'text-2xl font-bold text-white mb-6' }, 'Tous les Leads'),
                        React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl overflow-hidden' },
                            React.createElement('div', { className: 'overflow-x-auto' },
                                React.createElement('table', { className: 'w-full' },
                                    React.createElement('thead', { className: 'bg-slate-900/50' },
                                        React.createElement('tr', null,
                                            ['Apporteur', 'Client', 'Contact', 'Type', 'Budget', 'Statut', 'Prix vente', 'Commission', 'Actions'].map(header =>
                                                React.createElement('th', { 
                                                    key: header,
                                                    className: 'px-4 py-4 text-left text-sm font-semibold text-gray-300'
                                                }, header)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', { className: 'divide-y divide-slate-700' },
                                        leads.length === 0 
                                            ? React.createElement('tr', null,
                                                React.createElement('td', { colSpan: 9, className: 'px-6 py-8 text-center text-gray-400' },
                                                    'Aucun lead pour le moment'
                                                )
                                            )
                                            : leads.map(lead => {
                                                const referrer = users.find(u => u.id === lead.referrer_id);
                                                return React.createElement('tr', { key: lead.id, className: 'hover:bg-slate-700/30 transition' },
                                                    React.createElement('td', { className: 'px-4 py-4 text-gray-300' }, referrer?.name || 'N/A'),
                                                    React.createElement('td', { className: 'px-4 py-4' },
                                                        React.createElement('div', { className: 'font-semibold text-white' }, lead.client_name),
                                                        React.createElement('div', { className: 'text-sm text-gray-400' }, lead.client_email)
                                                    ),
                                                    React.createElement('td', { className: 'px-4 py-4 text-gray-300' }, lead.client_phone),
                                                    React.createElement('td', { className: 'px-4 py-4 text-gray-300' }, lead.property_type),
                                                    React.createElement('td', { className: 'px-4 py-4 text-gray-300' }, formatCurrency(lead.budget)),
                                                    React.createElement('td', { className: 'px-4 py-4' },
                                                        React.createElement('span', { className: `px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(lead.status)}` },
                                                            lead.status
                                                        )
                                                    ),
                                                    React.createElement('td', { className: 'px-4 py-4 text-gray-300' },
                                                        lead.sale_price ? formatCurrency(lead.sale_price) : '-'
                                                    ),
                                                    React.createElement('td', { className: 'px-4 py-4 font-bold text-yellow-500' },
                                                        lead.referrer_commission ? formatCurrency(lead.referrer_commission) : '-'
                                                    ),
                                                    React.createElement('td', { className: 'px-4 py-4' },
                                                        lead.status !== 'vendu' && React.createElement('select', {
                                                            value: lead.status,
                                                            onChange: (e) => {
                                                                const newStatus = e.target.value;
                                                                if (newStatus === 'vendu') {
                                                                    const price = prompt('Prix de vente (AED):');
                                                                    if (price) {
                                                                        handleUpdateLeadStatus(lead.id, newStatus, price);
                                                                    }
                                                                } else {
                                                                    handleUpdateLeadStatus(lead.id, newStatus);
                                                                }
                                                            },
                                                            className: 'px-3 py-2 bg-slate-700 text-white rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500'
                                                        },
                                                            React.createElement('option', { value: 'nouveau' }, 'Nouveau'),
                                                            React.createElement('option', { value: 'visite' }, 'Visite'),
                                                            React.createElement('option', { value: 'offre' }, 'Offre'),
                                                            React.createElement('option', { value: 'vendu' }, 'Vendu')
                                                        )
                                                    )
                                                );
                                            })
                                    )
                                )
                            )
                        ),
                        React.createElement('h2', { className: 'text-2xl font-bold text-white mb-6 mt-12' }, 'Tous les Apporteurs'),
                        React.createElement('div', { className: 'bg-slate-800/50 backdrop-blur-sm border border-yellow-500/20 rounded-xl overflow-hidden' },
                            React.createElement('div', { className: 'overflow-x-auto' },
                                React.createElement('table', { className: 'w-full' },
                                    React.createElement('thead', { className: 'bg-slate-900/50' },
                                        React.createElement('tr', null,
                                            ['Nom', 'Email', 'Téléphone', 'Leads apportés', 'Ventes', 'Total commissions'].map(header =>
                                                React.createElement('th', { 
                                                    key: header,
                                                    className: 'px-6 py-4 text-left text-sm font-semibold text-gray-300'
                                                }, header)
                                            )
                                        )
                                    ),
                                    React.createElement('tbody', { className: 'divide-y divide-slate-700' },
                                        allReferrers.map(referrer => {
                                            const referrerLeads = leads.filter(l => l.referrer_id === referrer.id);
                                            const sales = referrerLeads.filter(l => l.status === 'vendu').length;
                                            const totalCommissions = referrerLeads
                                                .filter(l => l.status === 'vendu')
                                                .reduce((sum, l) => sum + (l.referrer_commission || 0), 0);
                                            
                                            return React.createElement('tr', { key: referrer.id, className: 'hover:bg-slate-700/30 transition' },
                                                React.createElement('td', { className: 'px-6 py-4 font-semibold text-white' }, referrer.name),
                                                React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, referrer.email),
                                                React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, referrer.phone),
                                                React.createElement('td', { className: 'px-6 py-4 text-gray-300' }, referrerLeads.length),
                                                React.createElement('td', { className: 'px-6 py-4 text-green-400 font-semibold' }, sales),
                                                React.createElement('td', { className: 'px-6 py-4 font-bold text-yellow-500' }, formatCurrency(totalCommissions))
                                            );
                                        })
                                    )
                                )
                            )
                        )
                    )
                );
            }

            return null;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(
            React.createElement(RealEstateReferralApp)
        );
    </script>
</body>
</html>
